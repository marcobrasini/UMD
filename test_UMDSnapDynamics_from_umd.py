# -*- coding: utf-8 -*-
"""
Created on Wed May 18 17:55:50 2022

@author: marco
"""


from UMDSnapshot_from_umd import UMDSnapDynamics_from_umd

import pytest
import numpy as np
from UMDAtom import UMDAtom
from UMDLattice import UMDLattice
from UMDSnapshot import UMDSnapshot


UMDfile_mag = 'tests/mag5.70a1800T.umd'


position = np.array([[5.69600e+00, 5.69749e+00, 4.60000e-04],
                     [3.64000e-03, 3.56000e-03, 2.84787e+00],
                     [5.63000e-03, 2.84499e+00, 5.69930e+00],
                     [5.69597e+00, 2.85071e+00, 2.84751e+00],
                     [2.84784e+00, 7.40000e-04, 2.33000e-03],
                     [2.85261e+00, 4.25000e-03, 2.84564e+00],
                     [2.84616e+00, 2.85431e+00, 5.69737e+00],
                     [2.85209e+00, 2.85106e+00, 2.84850e+00],
                     [1.42054e+00, 1.42297e+00, 4.26935e+00],
                     [1.42595e+00, 4.27686e+00, 1.42279e+00],
                     [1.42997e+00, 4.27361e+00, 4.27090e+00],
                     [4.27452e+00, 1.43068e+00, 1.43067e+00],
                     [4.27349e+00, 1.42935e+00, 4.27053e+00],
                     [4.27828e+00, 4.27746e+00, 1.42139e+00],
                     [4.27875e+00, 4.28020e+00, 4.27464e+00],
                     [7.17620e-01, 7.08970e-01, 3.55889e+00],
                     [7.08640e-01, 3.56221e+00, 7.16760e-01],
                     [7.17170e-01, 3.55707e+00, 3.56378e+00],
                     [3.56786e+00, 7.16620e-01, 7.15020e-01],
                     [3.56371e+00, 7.11380e-01, 3.55908e+00],
                     [3.56494e+00, 3.56443e+00, 7.14600e-01],
                     [3.56672e+00, 3.56721e+00, 3.55788e+00],
                     [2.13207e+00, 2.13995e+00, 3.56558e+00],
                     [2.13206e+00, 4.98572e+00, 7.12870e-01],
                     [2.13810e+00, 4.98551e+00, 3.55736e+00],
                     [4.98827e+00, 2.14126e+00, 7.13100e-01],
                     [4.98976e+00, 2.13829e+00, 3.56367e+00],
                     [4.98715e+00, 4.98833e+00, 7.15920e-01],
                     [4.98928e+00, 4.98249e+00, 3.55798e+00],
                     [2.13490e+00, 7.14670e-01, 4.98542e+00],
                     [2.13875e+00, 3.56358e+00, 2.14015e+00],
                     [2.13180e+00, 3.56192e+00, 4.98918e+00],
                     [4.98282e+00, 7.17250e-01, 2.13218e+00],
                     [4.98803e+00, 7.16140e-01, 4.99029e+00],
                     [4.98982e+00, 3.56012e+00, 2.13226e+00],
                     [4.98705e+00, 3.56381e+00, 4.98975e+00],
                     [7.07690e-01, 2.13970e+00, 4.98707e+00],
                     [7.09360e-01, 4.99148e+00, 2.13545e+00],
                     [7.10840e-01, 4.98750e+00, 4.98879e+00],
                     [3.56316e+00, 2.13939e+00, 2.13757e+00],
                     [3.56687e+00, 2.13973e+00, 4.99026e+00],
                     [3.56642e+00, 4.98815e+00, 2.13277e+00],
                     [3.55873e+00, 4.99246e+00, 4.98356e+00],
                     [1.42801e+00, 1.42234e+00, 1.42710e+00]])
velocity = np.array([[-8.00000e-03, -5.02000e-03,  9.20000e-04],
                     [ 7.28000e-03,  7.12000e-03,  5.69574e+00],
                     [ 1.12600e-02,  5.68998e+00, -1.40000e-03],
                     [-8.06000e-03, -5.69858e+00,  5.69502e+00],
                     [ 5.69568e+00,  1.48000e-03,  4.66000e-03],
                     [-5.69478e+00,  8.50000e-03,  5.69128e+00],
                     [ 5.69232e+00, -5.69138e+00, -5.26000e-03],
                     [-5.69582e+00, -5.69788e+00,  5.69700e+00],
                     [ 2.84108e+00,  2.84594e+00, -2.86130e+00],
                     [ 2.85190e+00, -2.84628e+00,  2.84558e+00],
                     [ 2.85994e+00, -2.85278e+00, -2.85820e+00],
                     [-2.85096e+00,  2.86136e+00,  2.86134e+00],
                     [-2.85302e+00,  2.85870e+00, -2.85894e+00],
                     [-2.84344e+00, -2.84508e+00,  2.84278e+00],
                     [-2.84250e+00, -2.83960e+00, -2.85072e+00],
                     [ 1.43524e+00,  1.41794e+00, -4.28222e+00],
                     [ 1.41728e+00, -4.27558e+00,  1.43352e+00],
                     [ 1.43434e+00, -4.28586e+00, -4.27244e+00],
                     [-4.26428e+00,  1.43324e+00,  1.43004e+00],
                     [-4.27258e+00,  1.42276e+00, -4.28184e+00],
                     [-4.27012e+00, -4.27114e+00,  1.42920e+00],
                     [-4.26656e+00, -4.26558e+00, -4.28424e+00],
                     [ 4.26414e+00,  4.27990e+00, -4.26884e+00],
                     [ 4.26412e+00, -1.42856e+00,  1.42574e+00],
                     [ 4.27620e+00, -1.42898e+00, -4.28528e+00],
                     [-1.42346e+00,  4.28252e+00,  1.42620e+00],
                     [-1.42048e+00,  4.27658e+00, -4.27266e+00],
                     [-1.42570e+00, -1.42334e+00,  1.43184e+00],
                     [-1.42144e+00, -1.43502e+00, -4.28404e+00],
                     [ 4.26980e+00,  1.42934e+00, -1.42916e+00],
                     [ 4.27750e+00, -4.27284e+00,  4.28030e+00],
                     [ 4.26360e+00, -4.27616e+00, -1.42164e+00],
                     [-1.43436e+00,  1.43450e+00,  4.26436e+00],
                     [-1.42394e+00,  1.43228e+00, -1.41942e+00],
                     [-1.42036e+00, -4.27976e+00,  4.26452e+00],
                     [-1.42590e+00, -4.27238e+00, -1.42050e+00],
                     [ 1.41538e+00,  4.27940e+00, -1.42586e+00],
                     [ 1.41872e+00, -1.41704e+00,  4.27090e+00],
                     [ 1.42168e+00, -1.42500e+00, -1.42242e+00],
                     [-4.27368e+00,  4.27878e+00,  4.27514e+00],
                     [-4.26626e+00,  4.27946e+00, -1.41948e+00],
                     [-4.26716e+00, -1.42370e+00,  4.26554e+00],
                     [-4.28254e+00, -1.41508e+00, -1.43288e+00],
                     [ 2.85602e+00,  2.84468e+00,  2.85420e+00]])
force = np.array([[ 0.31302 ,  0.307053,  0.148226],
                  [ 0.650813,  0.579855, -0.778661],
                  [ 0.546355, -0.613068,  0.707196],
                  [ 0.332611, -0.202504, -0.208636],
                  [-0.621234,  0.777168,  0.595207],
                  [-0.236098,  0.147756, -0.225639],
                  [-0.11691 , -0.313361,  0.320225],
                  [-0.741705, -0.590528, -0.657186],
                  [ 0.147414,  0.060645,  0.049346],
                  [-0.084277, -0.043963,  0.023203],
                  [-0.125387,  0.036903,  0.009636],
                  [ 0.030996, -0.098751, -0.180826],
                  [ 0.075491, -0.041115,  0.161185],
                  [-0.062319, -0.066083,  0.025988],
                  [-0.019664, -0.093131, -0.034922],
                  [ 0.0732  ,  0.142326,  0.342689],
                  [ 0.218928,  0.352771,  0.106065],
                  [-0.338651, -0.247408, -0.357303],
                  [ 0.278489,  0.111959,  0.12072 ],
                  [-0.352752, -0.291264, -0.339557],
                  [-0.358489, -0.284976, -0.352783],
                  [ 0.29006 ,  0.279291,  0.341072],
                  [-0.109746, -0.18442 ,  0.338857],
                  [-0.111933, -0.361097,  0.141626],
                  [ 0.320456,  0.327332, -0.292642],
                  [-0.301249, -0.14042 ,  0.113721],
                  [ 0.266363,  0.31274 , -0.353778],
                  [ 0.304524,  0.305745, -0.356975],
                  [-0.313138, -0.269986,  0.377697],
                  [-0.114129,  0.11389 , -0.337774],
                  [-0.082712,  0.309217, -0.126998],
                  [ 0.393945, -0.309256,  0.289731],
                  [-0.316179,  0.161798, -0.091624],
                  [ 0.31031 , -0.361481,  0.281589],
                  [ 0.34051 , -0.320754,  0.391594],
                  [-0.315687,  0.346506, -0.370604],
                  [ 0.116311, -0.131652, -0.313757],
                  [ 0.115818, -0.30814 , -0.072065],
                  [-0.33908 ,  0.347058,  0.315778],
                  [ 0.314443, -0.095584, -0.079305],
                  [-0.386429,  0.320334,  0.244654],
                  [-0.335421,  0.339505,  0.32116 ],
                  [ 0.320857, -0.293875, -0.252954],
                  [ 0.023595, -0.01001 ,  0.007345]])


# %% UMDSnapDynamics_from_umd function tests
def test_UMDSnapDynamics_from_umd():
    """
    Test UMDSnapDynamics_from_umd function initializing a UMDSnapDynamics
    object from an umd file.

    """
    UMDSnapshot.natoms = 44
    with open(UMDfile_mag, 'r') as umd:
        snapDynamics = UMDSnapDynamics_from_umd(umd)
        assert np.array_equal(snapDynamics.position, position)
        assert np.array_equal(snapDynamics.velocity, velocity)
        assert np.array_equal(snapDynamics.force, force)
        umd.close()


def test_UMDSnapDynamics_from_umd_None():
    """
    Test the UMDSnapDynamics_from_umd function initializing no UMDSnapDynamics
    object from an umd file without any UMDSnapshot.

    """
    with open('tests/test_file_empty.umd', 'r') as umd:
        snapDynamics = UMDSnapDynamics_from_umd(umd)
        assert snapDynamics is None


test_UMDSnapDynamics_from_umd()
test_UMDSnapDynamics_from_umd_None()
